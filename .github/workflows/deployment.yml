name: Build And Publish to Amazon ECR

on:
  push:
    branches: [master]

jobs:
  build-and-test:
    uses: vti-do2402/cicd-core/.github/workflows/maven-spring-ci.yml@${{ vars.CICD_CORE_VERSION }}
    with:
      runs-on: ${{ vars.RUNS_ON }}
      distribution: ${{ vars.DISTRIBUTION }}

  build-and-publish:
    needs: build-and-test
    uses: vti-do2402/cicd-core/.github/workflows/ci-template.yml@${{ vars.CICD_CORE_VERSION }}
    with:
      runs-on: ${{ vars.RUNS_ON }}
      ecr-repository: ${{ vars.ECR_REPOSITORY }}

